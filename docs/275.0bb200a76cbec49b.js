"use strict";(self.webpackChunkpublic_square=self.webpackChunkpublic_square||[]).push([[275],{8458:(D,M,p)=>{p.d(M,{n:()=>P});var x=p(6174),c=p(4004),k=p(2076),h=p(4650),C=p(2753),t=p(608),T=p(1250),S=p(8503);let P=(()=>{class b{constructor(d,_,a,f){this._arweave=d,this._userAuth=_,this._appSettings=a,this._utils=f,this._ardb=new x.f(this._arweave.arweave),this._ardb2=new x.f(this._arweave.arweave)}like(d,_,a=[]){const f=this._userAuth.getPrivateKey(),y=this._userAuth.loginMethod,w=[{name:"App-Name",value:this._appSettings.protocolName},{name:"Version",value:this._appSettings.protocolVersion},{name:"Type",value:"like"},{name:"Like-Target",value:d.trim()},...a];if(!this._arweave.validateAddress(d))throw new Error("Invalid target tx! "+d);return this._arweave.uploadFileToArweave("Like","text/plain",f,w,y,_)}getStoryLikes(d,_,a){return this._ardb.searchTransactions([],_,a,[{name:"App-Name",values:[this._appSettings.protocolName]},{name:"Content-Type",values:["text/plain"]},{name:"Type",values:["like"]},{name:"Like-Target",values:[d]}]).pipe((0,c.U)(y=>y.map(r=>({id:r.id,owner:r.owner.address,blockId:r.block&&r.block.id?r.block.id:"",blockHeight:r.block&&r.block.height?r.block.height:0,dataSize:r.data?r.data.size:void 0,dataType:r.data?r.data.type:void 0,blockTimestamp:r.block&&r.block.timestamp?r.block.timestamp:void 0,tags:r.tags}))))}next(){return(0,k.D)(this._ardb.next()).pipe((0,c.U)(d=>d&&d.length?d.map(a=>({id:a.id,owner:a.owner.address,blockId:a.block&&a.block.id?a.block.id:"",blockHeight:a.block&&a.block.height?a.block.height:0,dataSize:a.data?a.data.size:void 0,dataType:a.data?a.data.type:void 0,blockTimestamp:a.block&&a.block.timestamp?a.block.timestamp:void 0,tags:a.tags})):[]))}getLikesFromUser(d,_,a){return this._ardb2.searchTransactions(d,_,a,[{name:"App-Name",values:[this._appSettings.protocolName]},{name:"Content-Type",values:["text/plain"]},{name:"Type",values:["like"]}]).pipe((0,c.U)(y=>y.map(r=>({id:r.id,owner:r.owner.address,blockId:r.block&&r.block.id?r.block.id:"",blockHeight:r.block&&r.block.height?r.block.height:0,dataSize:r.data?r.data.size:void 0,dataType:r.data?r.data.type:void 0,blockTimestamp:r.block&&r.block.timestamp?r.block.timestamp:void 0,tags:r.tags}))))}nextLikesFromUser(){return(0,k.D)(this._ardb2.next()).pipe((0,c.U)(d=>d&&d.length?d.map(a=>({id:a.id,owner:a.owner.address,blockId:a.block&&a.block.id?a.block.id:"",blockHeight:a.block&&a.block.height?a.block.height:0,dataSize:a.data?a.data.size:void 0,dataType:a.data?a.data.type:void 0,blockTimestamp:a.block&&a.block.timestamp?a.block.timestamp:void 0,tags:a.tags})):[]))}}return b.\u0275fac=function(d){return new(d||b)(h.LFG(C.N),h.LFG(t.H),h.LFG(T.X),h.LFG(S.F))},b.\u0275prov=h.Yz7({token:b,factory:b.\u0275fac,providedIn:"root"}),b})()},4777:(D,M,p)=>{p.d(M,{Y:()=>P});var x=p(6174),c=p(4004),k=p(2076),h=p(4650),C=p(2753),t=p(608),T=p(1250),S=p(8503);let P=(()=>{class b{constructor(d,_,a,f){this._arweave=d,this._userAuth=_,this._appSettings=a,this._utils=f,this._ardb=new x.f(this._arweave.arweave),this._ardb2=new x.f(this._arweave.arweave)}reply(d,_,a,f=[]){const y=this._userAuth.getPrivateKey(),w=this._userAuth.loginMethod,r=[{name:"App-Name",value:this._appSettings.protocolName},{name:"Version",value:this._appSettings.protocolVersion},{name:"Type",value:"reply"},{name:"In-Reply-To",value:d.trim()},...f];if(!this._arweave.validateAddress(d))throw new Error("Invalid target tx! "+d);return this._arweave.uploadFileToArweave(_,"text/plain",y,r,w,a)}getReplies(d,_,a){return this._ardb.searchTransactions([],_,a,[{name:"App-Name",values:[this._appSettings.protocolName]},{name:"Content-Type",values:["text/plain"]},{name:"Type",values:["reply"]},{name:"In-Reply-To",values:[d]}]).pipe((0,c.U)(y=>y.map(r=>({id:r.id,owner:r.owner.address,blockId:r.block&&r.block.id?r.block.id:"",blockHeight:r.block&&r.block.height?r.block.height:0,dataSize:r.data?r.data.size:void 0,dataType:r.data?r.data.type:void 0,blockTimestamp:r.block&&r.block.timestamp?r.block.timestamp:void 0,tags:r.tags}))))}next(){return(0,k.D)(this._ardb.next()).pipe((0,c.U)(d=>d&&d.length?d.map(a=>({id:a.id,owner:a.owner.address,blockId:a.block&&a.block.id?a.block.id:"",blockHeight:a.block&&a.block.height?a.block.height:0,dataSize:a.data?a.data.size:void 0,dataType:a.data?a.data.type:void 0,blockTimestamp:a.block&&a.block.timestamp?a.block.timestamp:void 0,tags:a.tags})):[]))}getRepliesFromUser(d,_,a){return this._ardb2.searchTransactions(d,_,a,[{name:"App-Name",values:[this._appSettings.protocolName]},{name:"Content-Type",values:["text/plain"]},{name:"Type",values:["reply"]}]).pipe((0,c.U)(y=>y.map(r=>({id:r.id,owner:r.owner.address,blockId:r.block&&r.block.id?r.block.id:"",blockHeight:r.block&&r.block.height?r.block.height:0,dataSize:r.data?r.data.size:void 0,dataType:r.data?r.data.type:void 0,blockTimestamp:r.block&&r.block.timestamp?r.block.timestamp:void 0,tags:r.tags}))))}nextRepliesFromUser(){return(0,k.D)(this._ardb2.next()).pipe((0,c.U)(d=>d&&d.length?d.map(a=>({id:a.id,owner:a.owner.address,blockId:a.block&&a.block.id?a.block.id:"",blockHeight:a.block&&a.block.height?a.block.height:0,dataSize:a.data?a.data.size:void 0,dataType:a.data?a.data.type:void 0,blockTimestamp:a.block&&a.block.timestamp?a.block.timestamp:void 0,tags:a.tags})):[]))}}return b.\u0275fac=function(d){return new(d||b)(h.LFG(C.N),h.LFG(t.H),h.LFG(T.X),h.LFG(S.F))},b.\u0275prov=h.Yz7({token:b,factory:b.\u0275fac,providedIn:"root"}),b})()},39:(D,M,p)=>{p.d(M,{n:()=>P});var x=p(8242),c=p(4650),k=p(4425),h=p(7009),C=p(6338),t=p(3238),T=p(7392),S=p(4463);let P=(()=>{class b{constructor(d,_,a){this.data=d,this._clipboard=_,this._snackBar=a,this.previousURL=""}ngOnInit(){}_copyLinkToClipboard(){this._clipboard.copy(this.data.fullURL),this.message("Copied to clipboard!","success","top")}message(d,_="",a){this._snackBar.open(d,"X",{duration:3e3,horizontalPosition:"center",verticalPosition:a,panelClass:_})}shareInSocialMedia(d){const _=encodeURIComponent(`${this.data.title}: ${this.data.content} Link: ${this.data.fullURL}`),a=encodeURIComponent(`${this.data.img}`),f=encodeURIComponent(`${this.data.title}`),y=encodeURIComponent(`${this.data.fullURL}`);switch(d){case"facebook":this.openWindowPopup(`https://www.facebook.com/share.php?u=${y}&quote=${_}&picture=${a}`);break;case"twitter":const r=`${f}: ${this.data.content}`.substr(0,240);this.openWindowPopup(`https://twitter.com/share?url=${y}&text=${r}`);break;case"whatsapp":this.openWindowPopup(`https://wa.me/?text=${_}`);break;case"copyLink":this._copyLinkToClipboard();break;default:this.message("Option not found!","error")}}openWindowPopup(d){null==this.windowObjectReference||this.windowObjectReference.closed?this.windowObjectReference=window.open(d,"_SOCIALWINDOW","resizable,scrollbars,status"):this.previousURL!==d?(this.windowObjectReference=window.open(d,"_SOCIALWINDOW","resizable=yes,scrollbars=yes,status=yes"),this.windowObjectReference.focus()):this.windowObjectReference.focus(),this.previousURL=d}}return b.\u0275fac=function(d){return new(d||b)(c.Y36(x.OG),c.Y36(k.TU),c.Y36(h.ux))},b.\u0275cmp=c.Xpm({type:b,selectors:[["app-bottom-sheet-share"]],decls:33,vars:15,consts:[[3,"click"],["matListAvatar","","src","./assets/images/social-media/facebookR.png"],["mat-line",""],["matListAvatar","","src","./assets/images/social-media/twitterR.png"],["matListAvatar","","src","./assets/images/social-media/whatsappR.png",1,"not-rounded"],["matListIcon",""]],template:function(d,_){1&d&&(c.TgZ(0,"h3"),c._uU(1),c.ALo(2,"translate"),c.qZA(),c.TgZ(3,"mat-nav-list")(4,"mat-list-item",0),c.NdJ("click",function(){return _.shareInSocialMedia("facebook")}),c._UZ(5,"img",1),c.TgZ(6,"span",2),c._uU(7,"Facebook"),c.qZA(),c.TgZ(8,"span",2),c._uU(9),c.ALo(10,"translate"),c.qZA()(),c.TgZ(11,"mat-list-item",0),c.NdJ("click",function(){return _.shareInSocialMedia("twitter")}),c._UZ(12,"img",3),c.TgZ(13,"span",2),c._uU(14,"Twitter"),c.qZA(),c.TgZ(15,"span",2),c._uU(16),c.ALo(17,"translate"),c.qZA()(),c.TgZ(18,"mat-list-item",0),c.NdJ("click",function(){return _.shareInSocialMedia("whatsapp")}),c._UZ(19,"img",4),c.TgZ(20,"span",2),c._uU(21,"WhatsApp"),c.qZA(),c.TgZ(22,"span",2),c._uU(23),c.ALo(24,"translate"),c.qZA()(),c.TgZ(25,"mat-list-item",0),c.NdJ("click",function(){return _.shareInSocialMedia("copyLink")}),c.TgZ(26,"mat-icon",5),c._uU(27,"link"),c.qZA(),c.TgZ(28,"span",2),c._uU(29,"Copy link"),c.qZA(),c.TgZ(30,"span",2),c._uU(31),c.ALo(32,"translate"),c.qZA()()()),2&d&&(c.xp6(1),c.Oqu(c.lcZ(2,5,"DIALOGS.SHARE.TITLE")),c.xp6(8),c.Oqu(c.lcZ(10,7,"DIALOGS.SHARE.FACEBOOK")),c.xp6(7),c.Oqu(c.lcZ(17,9,"DIALOGS.SHARE.TWITTER")),c.xp6(7),c.Oqu(c.lcZ(24,11,"DIALOGS.SHARE.WHATSAPP")),c.xp6(8),c.Oqu(c.lcZ(32,13,"DIALOGS.SHARE.COPY")))},dependencies:[C.Hk,C.Tg,C.eA,t.X2,C.Nh,T.Hw,S.X$],styles:[".mat-list-avatar.not-rounded[_ngcontent-%COMP%]{border-radius:0%!important}.mat-line[_ngcontent-%COMP%]{font-family:Roboto Mono,monospace}h3[_ngcontent-%COMP%]{padding-top:20px;padding-bottom:0}"]}),b})()},3275:(D,M,p)=>{p.d(M,{i:()=>De});var x=p(727),c=p(39),k=p(985),h=p(5938),C=p(4006),t=p(4650),T=p(8503),S=p(4777),P=p(1250),b=p(2753),v=p(6895),d=p(6709),_=p(7392),a=p(3546),f=p(4859),y=p(1572),w=p(130),r=p(4463);function I(n,s){if(1&n&&(t.TgZ(0,"p",12),t._UZ(1,"img",13),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("src",e.data.postOwnerImage,t.LSH)}}function E(n,s){if(1&n&&(t.TgZ(0,"p")(1,"strong"),t._uU(2),t.qZA()()),2&n){const e=t.oxw(2);t.xp6(2),t.Oqu(e.data.postOwnerUsername?e.data.postOwnerUsername:e.data.postOwner)}}function G(n,s){if(1&n&&(t.TgZ(0,"div"),t._uU(1),t.qZA()),2&n){const e=t.oxw(3);t.xp6(1),t.hij(" ",e.data.postContent," ")}}function V(n,s){if(1&n&&(t.ynx(0),t.TgZ(1,"div",14,15),t.YNc(3,G,2,1,"div",1),t.qZA(),t.BQk()),2&n){const e=t.oxw(2);t.xp6(3),t.Q6J("ngIf",!e.loadingReply&&e.data.postContent)}}function X(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"div"),t.YNc(1,I,2,1,"p",7),t.YNc(2,E,3,1,"p",1),t.YNc(3,V,4,1,"ng-container",1),t.TgZ(4,"h5",8),t._uU(5," Your reply: "),t.qZA(),t.TgZ(6,"app-create-post-card",9),t.NdJ("contentChangeEvent",function(i){t.CHM(e);const l=t.oxw();return t.KtG(l.contentChangeEvent(i))}),t.qZA(),t.TgZ(7,"p",10)(8,"mat-checkbox",11),t._uU(9," Reply for FREE (Dispatch method) "),t.qZA()()()}if(2&n){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",e.data.postOwnerImage),t.xp6(1),t.Q6J("ngIf",e.data.postOwner),t.xp6(1),t.Q6J("ngIf",e.validateContentType(e.data.contentType,"text")),t.xp6(3),t.Q6J("emitContent",!0)("showSubmitButton",!1)("account",e.data.myAddress),t.xp6(2),t.Q6J("formControl",e.useDispatch)}}function tt(n,s){1&n&&(t.TgZ(0,"h3",16),t._uU(1," Please login first! "),t.qZA())}function et(n,s){1&n&&(t.TgZ(0,"div")(1,"p")(2,"span"),t._uU(3,"Sending tx ..."),t.qZA(),t._UZ(4,"mat-spinner",17),t.qZA()()),2&n&&(t.xp6(4),t.Q6J("diameter",20))}function nt(n,s){if(1&n&&(t.TgZ(0,"div")(1,"p"),t._uU(2),t.qZA(),t.TgZ(3,"p"),t._uU(4," Your transaction is gonna be mined in the next minutes. You can take a coffee now! \u2615 "),t.qZA()()),2&n){const e=t.oxw();t.xp6(2),t.hij("Tx ",e.replyTxId," created succesfully!")}}let ot=(()=>{class n{constructor(e,o,i,l,m,u){this._dialogRef=e,this.data=o,this._utils=i,this._reply=l,this._appSettings=m,this._arweave=u,this.useDispatch=new C.p4(!1),this.loadingReply=!1,this._replySubscription=x.w0.EMPTY,this.replyTxId="",this.message=""}ngOnInit(){}close(e=""){this._dialogRef.close(e)}submit(){const e=!this.useDispatch.value;this.loadingReply=!0,this._replySubscription=this._reply.reply(this.data.txId,this.message,e).subscribe({next:o=>{this.loadingReply=!1,this.replyTxId=o.id},error:o=>{this.loadingReply=!1,console.error("Error!",o),this._utils.message("Error!","error")}})}ngOnDestroy(){this._replySubscription.unsubscribe()}contentChangeEvent(e){this.message=e}validateContentType(e,o){return!!Object.prototype.hasOwnProperty.call(this._appSettings.supportedFiles,o)&&this._appSettings.supportedFiles[o].indexOf(e)>=0}getFullImgUrlFromTx(e){return`${this._arweave.baseURL}${e}`}openLink(e,o){e.stopPropagation(),window.open(`${this._arweave.baseURL}${o}`,"_blank")}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(h.so),t.Y36(h.WI),t.Y36(T.F),t.Y36(S.Y),t.Y36(P.X),t.Y36(b.N))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-reply-dialog"]],decls:15,vars:9,consts:[[1,"content"],[4,"ngIf"],["class","text-center login-first",4,"ngIf"],["align","start"],["mat-button","","cdkFocusInitial","",3,"disabled","click"],[1,"spacer"],["mat-flat-button","","color","accent",1,"reply-btn",3,"disabled","click"],["class","text-center",4,"ngIf"],[1,"reply-subtitle","clear-both"],[3,"emitContent","showSubmitButton","account","contentChangeEvent"],[1,"text-right"],[1,"dispatch-chk",3,"formControl"],[1,"text-center"],["mat-card-avatar","",1,"avatar",3,"src"],[1,"content","fadeIn"],["contentContainer",""],[1,"text-center","login-first"],["color","accent",3,"diameter"]],template:function(e,o){1&e&&(t.TgZ(0,"mat-dialog-content",0),t.YNc(1,X,10,7,"div",1),t.YNc(2,tt,2,0,"h3",2),t.YNc(3,et,5,1,"div",1),t.YNc(4,nt,5,1,"div",1),t.qZA(),t.TgZ(5,"mat-dialog-actions",3)(6,"button",4),t.NdJ("click",function(){return o.close()}),t._uU(7,"Close"),t.qZA(),t._UZ(8,"div",5),t.TgZ(9,"button",6),t.NdJ("click",function(){return o.submit()}),t.TgZ(10,"mat-icon"),t._uU(11,"reply"),t.qZA(),t.TgZ(12,"span"),t._uU(13),t.ALo(14,"translate"),t.qZA()()()),2&e&&(t.xp6(1),t.Q6J("ngIf",!o.loadingReply&&!o.replyTxId&&o.data.myAddress),t.xp6(1),t.Q6J("ngIf",!o.data.myAddress),t.xp6(1),t.Q6J("ngIf",o.loadingReply),t.xp6(1),t.Q6J("ngIf",!o.loadingReply&&o.replyTxId),t.xp6(2),t.Q6J("disabled",o.loadingReply),t.xp6(3),t.Q6J("disabled",o.loadingReply||""!==o.replyTxId||""==o.message),t.xp6(4),t.Oqu(t.lcZ(14,7,"GENERAL.STORY.REPLY")))},dependencies:[v.O5,d.oG,_.Hw,a.kc,C.JJ,C.oH,f.lW,y.Ou,h.xY,h.H8,w.b,r.X$],styles:[".content[_ngcontent-%COMP%]{padding:10px;min-height:100px;max-width:680px;min-width:200px}.content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{padding:6px}.title-text[_ngcontent-%COMP%]{font-weight:700}.mat-dialog-container[_ngcontent-%COMP%]{padding:0}@media (min-width: 420px){.content[_ngcontent-%COMP%]{min-width:400px}}@media (min-width: 820px){.content[_ngcontent-%COMP%]{min-width:666px}}.wallets[_ngcontent-%COMP%], .dispatch-chk[_ngcontent-%COMP%]{font-size:12px}.mat-spinner[_ngcontent-%COMP%]{display:inline;margin-left:12px}.avatar[_ngcontent-%COMP%]{margin-top:10px;width:62px;height:62px;cursor:pointer;border-radius:32px;float:left;margin-right:18px}.reply-subtitle[_ngcontent-%COMP%]{margin-top:24px;margin-bottom:2px}.reply-btn[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-left:6px}.story-image-container[_ngcontent-%COMP%]{text-align:center;padding:20px}.story-image-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:50%}.story-video-container[_ngcontent-%COMP%]{text-align:center;padding:20px}.story-video-container[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{max-width:50%}.story-audio-container[_ngcontent-%COMP%]{text-align:center;padding:20px}.story-audio-container[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{max-width:50%}"]}),n})();var it=p(8458);function at(n,s){if(1&n&&(t.TgZ(0,"p",9),t._UZ(1,"img",10),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("src",e.data.postOwnerImage,t.LSH)}}function st(n,s){if(1&n&&(t.TgZ(0,"p")(1,"strong"),t._uU(2),t.qZA()()),2&n){const e=t.oxw(2);t.xp6(2),t.Oqu(e.data.postOwnerUsername?e.data.postOwnerUsername:e.data.postOwner)}}function rt(n,s){if(1&n&&(t.TgZ(0,"div"),t._uU(1),t.qZA()),2&n){const e=t.oxw(3);t.xp6(1),t.hij(" ",e.data.postContent," ")}}function ct(n,s){if(1&n&&(t.ynx(0),t.TgZ(1,"div",11,12),t.YNc(3,rt,2,1,"div",1),t.qZA(),t.BQk()),2&n){const e=t.oxw(2);t.xp6(3),t.Q6J("ngIf",!e.loadingLike&&e.data.postContent)}}function lt(n,s){if(1&n&&(t.TgZ(0,"div"),t.YNc(1,at,2,1,"p",2),t.YNc(2,st,3,1,"p",1),t.YNc(3,ct,4,1,"ng-container",1),t.TgZ(4,"p",7)(5,"mat-checkbox",8),t._uU(6," Like for FREE (Dispatch method) "),t.qZA()()()),2&n){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",e.data.postOwnerImage),t.xp6(1),t.Q6J("ngIf",e.data.postOwner),t.xp6(1),t.Q6J("ngIf",e.validateContentType(e.data.contentType,"text")),t.xp6(2),t.Q6J("formControl",e.useDispatch)}}function pt(n,s){1&n&&(t.TgZ(0,"h3",9),t._uU(1," Please login first! "),t.qZA())}function dt(n,s){1&n&&(t.TgZ(0,"div")(1,"p")(2,"span"),t._uU(3,"Sending tx ..."),t.qZA(),t._UZ(4,"mat-spinner",13),t.qZA()()),2&n&&(t.xp6(4),t.Q6J("diameter",20))}function gt(n,s){if(1&n&&(t.TgZ(0,"div")(1,"p"),t._uU(2),t.qZA(),t.TgZ(3,"p"),t._uU(4," Your transaction is gonna be mined in the next minutes. You can take a coffee now! \u2615 "),t.qZA()()),2&n){const e=t.oxw();t.xp6(2),t.hij("Tx ",e.likeTxId," created succesfully!")}}let _t=(()=>{class n{constructor(e,o,i,l,m,u){this._dialogRef=e,this.data=o,this._utils=i,this._like=l,this._appSettings=m,this._arweave=u,this.useDispatch=new C.p4(!1),this.loadingLike=!1,this._likeSubscription=x.w0.EMPTY,this.likeTxId=""}ngOnInit(){}close(e=""){this._dialogRef.close(e)}submit(){const e=!this.useDispatch.value;this.loadingLike=!0,this._likeSubscription=this._like.like(this.data.txId,e).subscribe({next:o=>{this.loadingLike=!1,this.likeTxId=o.id},error:o=>{this.loadingLike=!1,console.error("Error!",o),this._utils.message("Error!","error")}})}ngOnDestroy(){this._likeSubscription.unsubscribe()}validateContentType(e,o){return!!Object.prototype.hasOwnProperty.call(this._appSettings.supportedFiles,o)&&this._appSettings.supportedFiles[o].indexOf(e)>=0}getFullImgUrlFromTx(e){return`${this._arweave.baseURL}${e}`}openLink(e,o){e.stopPropagation(),window.open(`${this._arweave.baseURL}${o}`,"_blank")}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(h.so),t.Y36(h.WI),t.Y36(T.F),t.Y36(it.n),t.Y36(P.X),t.Y36(b.N))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-like-dialog"]],decls:15,vars:9,consts:[[1,"content","border-right-special"],[4,"ngIf"],["class","text-center",4,"ngIf"],["align","start"],["mat-button","","cdkFocusInitial","",3,"disabled","click"],[1,"spacer"],["mat-flat-button","","color","accent",1,"like-btn",3,"disabled","click"],[1,"text-right"],[1,"dispatch-chk",3,"formControl"],[1,"text-center"],["mat-card-avatar","",1,"avatar",3,"src"],[1,"content","fadeIn"],["contentContainer",""],["color","accent",3,"diameter"]],template:function(e,o){1&e&&(t.TgZ(0,"mat-dialog-content",0),t.YNc(1,lt,7,4,"div",1),t.YNc(2,pt,2,0,"h3",2),t.YNc(3,dt,5,1,"div",1),t.YNc(4,gt,5,1,"div",1),t.qZA(),t.TgZ(5,"mat-dialog-actions",3)(6,"button",4),t.NdJ("click",function(){return o.close()}),t._uU(7,"Close"),t.qZA(),t._UZ(8,"div",5),t.TgZ(9,"button",6),t.NdJ("click",function(){return o.submit()}),t.TgZ(10,"mat-icon"),t._uU(11,"favorite"),t.qZA(),t.TgZ(12,"span"),t._uU(13),t.ALo(14,"translate"),t.qZA()()()),2&e&&(t.xp6(1),t.Q6J("ngIf",!o.loadingLike&&!o.likeTxId&&o.data.myAddress),t.xp6(1),t.Q6J("ngIf",!o.data.myAddress),t.xp6(1),t.Q6J("ngIf",o.loadingLike),t.xp6(1),t.Q6J("ngIf",!o.loadingLike&&o.likeTxId),t.xp6(2),t.Q6J("disabled",o.loadingLike),t.xp6(3),t.Q6J("disabled",o.loadingLike||""!==o.likeTxId||!o.data.myAddress),t.xp6(4),t.Oqu(t.lcZ(14,7,"GENERAL.STORY.LIKE")))},dependencies:[v.O5,d.oG,_.Hw,a.kc,C.JJ,C.oH,f.lW,y.Ou,h.xY,h.H8,r.X$],styles:[".content[_ngcontent-%COMP%]{padding:10px;min-height:100px;max-width:680px;min-width:200px}.content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{padding:6px}.title-text[_ngcontent-%COMP%]{font-weight:700}.mat-dialog-container[_ngcontent-%COMP%]{padding:0}@media (min-width: 420px){.content[_ngcontent-%COMP%]{min-width:400px}}@media (min-width: 820px){.content[_ngcontent-%COMP%]{min-width:666px}}.wallets[_ngcontent-%COMP%], .dispatch-chk[_ngcontent-%COMP%]{font-size:12px}.mat-spinner[_ngcontent-%COMP%]{display:inline;margin-left:12px}.avatar[_ngcontent-%COMP%]{margin-top:10px;width:62px;height:62px;cursor:pointer;border-radius:32px;float:left;margin-right:18px}.like-btn[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-left:6px}.story-image-container[_ngcontent-%COMP%]{text-align:center;padding:20px}.story-image-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:50%}.story-video-container[_ngcontent-%COMP%]{text-align:center;padding:20px}.story-video-container[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{max-width:50%}.story-audio-container[_ngcontent-%COMP%]{text-align:center;padding:20px}.story-audio-container[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{max-width:50%}"]}),n})();var N=p(6174),L=p(4004),Q=p(2076),z=p(608);let ut=(()=>{class n{constructor(e,o,i,l){this._arweave=e,this._userAuth=o,this._appSettings=i,this._utils=l,this._ardb=new N.f(this._arweave.arweave),this._ardb2=new N.f(this._arweave.arweave)}repost(e,o,i=[]){const l=this._userAuth.getPrivateKey(),m=this._userAuth.loginMethod,u=[{name:"App-Name",value:this._appSettings.protocolName},{name:"Version",value:this._appSettings.protocolVersion},{name:"Type",value:"repost"},{name:"Post-Id",value:e.trim()},...i];if(!this._arweave.validateAddress(e))throw new Error("Invalid target tx! "+e);return this._arweave.uploadFileToArweave("Repost","text/plain",l,u,m,o)}getStoryReposts(e,o,i){return this._ardb.searchTransactions([],o,i,[{name:"App-Name",values:[this._appSettings.protocolName]},{name:"Content-Type",values:["text/plain"]},{name:"Type",values:["repost"]},{name:"Post-Id",values:[e]}]).pipe((0,L.U)(m=>m.map(g=>({id:g.id,owner:g.owner.address,blockId:g.block&&g.block.id?g.block.id:"",blockHeight:g.block&&g.block.height?g.block.height:0,dataSize:g.data?g.data.size:void 0,dataType:g.data?g.data.type:void 0,blockTimestamp:g.block&&g.block.timestamp?g.block.timestamp:void 0,tags:g.tags}))))}next(){return(0,Q.D)(this._ardb.next()).pipe((0,L.U)(e=>e&&e.length?e.map(i=>({id:i.id,owner:i.owner.address,blockId:i.block&&i.block.id?i.block.id:"",blockHeight:i.block&&i.block.height?i.block.height:0,dataSize:i.data?i.data.size:void 0,dataType:i.data?i.data.type:void 0,blockTimestamp:i.block&&i.block.timestamp?i.block.timestamp:void 0,tags:i.tags})):[]))}getRepostsFromUser(e,o,i){return this._ardb2.searchTransactions(e,o,i,[{name:"App-Name",values:[this._appSettings.protocolName]},{name:"Content-Type",values:["text/plain"]},{name:"Type",values:["repost"]}]).pipe((0,L.U)(m=>m.map(g=>({id:g.id,owner:g.owner.address,blockId:g.block&&g.block.id?g.block.id:"",blockHeight:g.block&&g.block.height?g.block.height:0,dataSize:g.data?g.data.size:void 0,dataType:g.data?g.data.type:void 0,blockTimestamp:g.block&&g.block.timestamp?g.block.timestamp:void 0,tags:g.tags}))))}nextRepostsFromUser(){return(0,Q.D)(this._ardb2.next()).pipe((0,L.U)(e=>e&&e.length?e.map(i=>({id:i.id,owner:i.owner.address,blockId:i.block&&i.block.id?i.block.id:"",blockHeight:i.block&&i.block.height?i.block.height:0,dataSize:i.data?i.data.size:void 0,dataType:i.data?i.data.type:void 0,blockTimestamp:i.block&&i.block.timestamp?i.block.timestamp:void 0,tags:i.tags})):[]))}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(b.N),t.LFG(z.H),t.LFG(P.X),t.LFG(T.F))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function mt(n,s){if(1&n&&(t.TgZ(0,"p",9),t._UZ(1,"img",10),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("src",e.data.postOwnerImage,t.LSH)}}function ht(n,s){if(1&n&&(t.TgZ(0,"p")(1,"strong"),t._uU(2),t.qZA()()),2&n){const e=t.oxw(2);t.xp6(2),t.Oqu(e.data.postOwnerUsername?e.data.postOwnerUsername:e.data.postOwner)}}function ft(n,s){if(1&n&&(t.TgZ(0,"div"),t._uU(1),t.qZA()),2&n){const e=t.oxw(3);t.xp6(1),t.hij(" ",e.data.postContent," ")}}function bt(n,s){if(1&n&&(t.ynx(0),t.TgZ(1,"div",11,12),t.YNc(3,ft,2,1,"div",1),t.qZA(),t.BQk()),2&n){const e=t.oxw(2);t.xp6(3),t.Q6J("ngIf",!e.loadingRepost&&e.data.postContent)}}function yt(n,s){if(1&n&&(t.TgZ(0,"div"),t.YNc(1,mt,2,1,"p",2),t.YNc(2,ht,3,1,"p",1),t.YNc(3,bt,4,1,"ng-container",1),t.TgZ(4,"p",7)(5,"mat-checkbox",8),t._uU(6," Repost for FREE (Dispatch method) "),t.qZA()()()),2&n){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",e.data.postOwnerImage),t.xp6(1),t.Q6J("ngIf",e.data.postOwner),t.xp6(1),t.Q6J("ngIf",e.validateContentType(e.data.contentType,"text")),t.xp6(2),t.Q6J("formControl",e.useDispatch)}}function Ct(n,s){1&n&&(t.TgZ(0,"h3",9),t._uU(1," Please login first! "),t.qZA())}function xt(n,s){1&n&&(t.TgZ(0,"div")(1,"p")(2,"span"),t._uU(3,"Sending tx ..."),t.qZA(),t._UZ(4,"mat-spinner",13),t.qZA()()),2&n&&(t.xp6(4),t.Q6J("diameter",20))}function vt(n,s){if(1&n&&(t.TgZ(0,"div")(1,"p"),t._uU(2),t.qZA(),t.TgZ(3,"p"),t._uU(4," Your transaction is gonna be mined in the next minutes. You can take a coffee now! \u2615 "),t.qZA()()),2&n){const e=t.oxw();t.xp6(2),t.hij("Tx ",e.repostTxId," created succesfully!")}}let Tt=(()=>{class n{constructor(e,o,i,l,m,u){this._dialogRef=e,this.data=o,this._utils=i,this._repost=l,this._appSettings=m,this._arweave=u,this.useDispatch=new C.p4(!1),this.loadingRepost=!1,this._repostSubscription=x.w0.EMPTY,this.repostTxId=""}ngOnInit(){}close(e=""){this._dialogRef.close(e)}submit(){const e=!this.useDispatch.value;this.loadingRepost=!0,this._repostSubscription=this._repost.repost(this.data.txId,e).subscribe({next:o=>{this.loadingRepost=!1,this.repostTxId=o.id},error:o=>{this.loadingRepost=!1,console.error("Error!",o),this._utils.message("Error!","error")}})}ngOnDestroy(){this._repostSubscription.unsubscribe()}validateContentType(e,o){return!!Object.prototype.hasOwnProperty.call(this._appSettings.supportedFiles,o)&&this._appSettings.supportedFiles[o].indexOf(e)>=0}getFullImgUrlFromTx(e){return`${this._arweave.baseURL}${e}`}openLink(e,o){e.stopPropagation(),window.open(`${this._arweave.baseURL}${o}`,"_blank")}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(h.so),t.Y36(h.WI),t.Y36(T.F),t.Y36(ut),t.Y36(P.X),t.Y36(b.N))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-repost-dialog"]],decls:15,vars:9,consts:[[1,"content","border-right-special"],[4,"ngIf"],["class","text-center",4,"ngIf"],["align","start"],["mat-button","","cdkFocusInitial","",3,"disabled","click"],[1,"spacer"],["mat-flat-button","","color","accent",1,"repost-btn",3,"disabled","click"],[1,"text-right"],[1,"dispatch-chk",3,"formControl"],[1,"text-center"],["mat-card-avatar","",1,"avatar",3,"src"],[1,"content","fadeIn"],["contentContainer",""],["color","accent",3,"diameter"]],template:function(e,o){1&e&&(t.TgZ(0,"mat-dialog-content",0),t.YNc(1,yt,7,4,"div",1),t.YNc(2,Ct,2,0,"h3",2),t.YNc(3,xt,5,1,"div",1),t.YNc(4,vt,5,1,"div",1),t.qZA(),t.TgZ(5,"mat-dialog-actions",3)(6,"button",4),t.NdJ("click",function(){return o.close()}),t._uU(7,"Close"),t.qZA(),t._UZ(8,"div",5),t.TgZ(9,"button",6),t.NdJ("click",function(){return o.submit()}),t.TgZ(10,"mat-icon"),t._uU(11,"repeat"),t.qZA(),t.TgZ(12,"span"),t._uU(13),t.ALo(14,"translate"),t.qZA()()()),2&e&&(t.xp6(1),t.Q6J("ngIf",!o.loadingRepost&&!o.repostTxId&&o.data.myAddress),t.xp6(1),t.Q6J("ngIf",!o.data.myAddress),t.xp6(1),t.Q6J("ngIf",o.loadingRepost),t.xp6(1),t.Q6J("ngIf",!o.loadingRepost&&o.repostTxId),t.xp6(2),t.Q6J("disabled",o.loadingRepost),t.xp6(3),t.Q6J("disabled",o.loadingRepost||""!==o.repostTxId||!o.data.myAddress),t.xp6(4),t.Oqu(t.lcZ(14,7,"GENERAL.STORY.REPOST")))},dependencies:[v.O5,d.oG,_.Hw,a.kc,C.JJ,C.oH,f.lW,y.Ou,h.xY,h.H8,r.X$],styles:[".content[_ngcontent-%COMP%]{padding:10px;min-height:100px;max-width:680px;min-width:200px}.content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{padding:6px}.title-text[_ngcontent-%COMP%]{font-weight:700}.mat-dialog-container[_ngcontent-%COMP%]{padding:0}@media (min-width: 420px){.content[_ngcontent-%COMP%]{min-width:400px}}@media (min-width: 820px){.content[_ngcontent-%COMP%]{min-width:666px}}.wallets[_ngcontent-%COMP%], .dispatch-chk[_ngcontent-%COMP%]{font-size:12px}.mat-spinner[_ngcontent-%COMP%]{display:inline;margin-left:12px}.avatar[_ngcontent-%COMP%]{margin-top:10px;width:62px;height:62px;cursor:pointer;border-radius:32px;float:left;margin-right:18px}.repost-btn[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-left:6px}.story-image-container[_ngcontent-%COMP%]{text-align:center;padding:20px}.story-image-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:50%}.story-video-container[_ngcontent-%COMP%]{text-align:center;padding:20px}.story-video-container[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{max-width:50%}.story-audio-container[_ngcontent-%COMP%]{text-align:center;padding:20px}.story-audio-container[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{max-width:50%}"]}),n})();var Pt=p(2425),J=p(5089),wt=p(8242),F=p(4135),q=p(6338),kt=p(3238),Ot=p(4850),Mt=p(502),B=p(1561),H=p(9197),$=p(266),St=p(5051),It=p(3900),j=p(8505);const Zt=["contentContainer"];function At(n,s){1&n&&t._UZ(0,"mat-spinner",5),2&n&&t.Q6J("diameter",40)}function Lt(n,s){if(1&n&&(t.TgZ(0,"div",3),t.YNc(1,At,1,1,"mat-spinner",4),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",e.substoryContent.loading)}}function Rt(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"div",8)(1,"p"),t._uU(2),t.qZA(),t.TgZ(3,"button",9),t.NdJ("click",function(i){t.CHM(e);const l=t.oxw(2);return t.KtG(l.openStory(i,l.substory.id))}),t.TgZ(4,"mat-icon",10),t._uU(5,"open_in_new"),t.qZA()()()}if(2&n){const e=t.oxw(2);t.xp6(2),t.hij(" ",e.substoryContent.error," ")}}function Ut(n,s){if(1&n&&t._UZ(0,"p",15),2&n){const e=t.oxw(3);t.Q6J("innerHTML",e.substoryContent.content,t.oJD)}}function Dt(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"div",16)(1,"button",17),t.NdJ("click",function(i){t.CHM(e);const l=t.oxw(3);return t.KtG(l.seeMore(i))}),t._uU(2," See more "),t.qZA()()}}const Et=function(n,s){return["/",n,s]};function Jt(n,s){if(1&n&&(t.TgZ(0,"div",16)(1,"button",18),t._uU(2," Open substory "),t.qZA()()),2&n){const e=t.oxw(3);t.xp6(1),t.Q6J("routerLink",t.WLB(1,Et,e.owner,e.substory.id))}}function Yt(n,s){if(1&n&&(t.TgZ(0,"div",11,12),t.YNc(2,Ut,1,1,"p",13),t.YNc(3,Dt,3,0,"div",14),t.YNc(4,Jt,3,4,"div",14),t.qZA()),2&n){const e=t.oxw(2);t.xp6(2),t.Q6J("ngIf",e.substoryContent.content&&!e.substoryContent.loading),t.xp6(1),t.Q6J("ngIf",!e.substoryContent.loading&&e.substoryContent.raw&&e.showStoryMoreTextBtn()),t.xp6(1),t.Q6J("ngIf",!e.substoryContent.loading&&e.fullMode)}}function Nt(n,s){if(1&n&&(t.TgZ(0,"div",3),t.YNc(1,Rt,6,1,"div",6),t.YNc(2,Yt,5,3,"div",7),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",e.substoryContent.error),t.xp6(1),t.Q6J("ngIf",e.substoryContent.content)}}function Qt(n,s){1&n&&t._UZ(0,"mat-spinner",5),2&n&&t.Q6J("diameter",40)}function zt(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"div",8)(1,"p"),t._uU(2),t.qZA(),t.TgZ(3,"button",9),t.NdJ("click",function(i){t.CHM(e);const l=t.oxw(2);return t.KtG(l.openLink(i,l.getYoutubeUrl(l.substory.id)))}),t.TgZ(4,"mat-icon",10),t._uU(5,"open_in_new"),t.qZA()()()}if(2&n){const e=t.oxw(2);t.xp6(2),t.hij(" ",e.substoryContent.error," ")}}function Ft(n,s){if(1&n&&(t.TgZ(0,"div",21),t._UZ(1,"iframe",22),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("src",e.substoryContent.content,t.uOi)}}function qt(n,s){if(1&n&&(t.TgZ(0,"div",19),t.YNc(1,Qt,1,1,"mat-spinner",4),t.YNc(2,zt,6,1,"div",6),t.YNc(3,Ft,2,1,"div",20),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",e.substoryContent.loading),t.xp6(1),t.Q6J("ngIf",e.substoryContent.error),t.xp6(1),t.Q6J("ngIf",e.substoryContent.content&&!e.substoryContent.error)}}let Bt=(()=>{class n{constructor(e,o,i,l,m,u){this._arweave=e,this._utils=o,this._dialog=i,this._userSettings=l,this._appSettings=m,this._post=u,this.substoryContent={type:"",loading:!0,content:"",error:"",raw:""},this.substoryContentSubscription=x.w0.EMPTY,this.loadingSubstoryEvent=new t.vpe,this.owner="",this.contentError="",this.maxPreviewSize=250,this.realPreviewSize=this.maxPreviewSize,this.fullMode=!1}ngOnInit(){"tx"===this.substory.type&&this.substory.id?this.loadTx(this.substory.id):"youtube"===this.substory.type&&this.substory.id?this.loadYoutubeVideo(this.substory.id):console.error("Player: Unknown type")}loadTx(e){this.loadingSubstoryEvent.emit(!0),this.realPreviewSize=this.maxPreviewSize,this.substoryContentSubscription=this.loadMetadata(e).pipe((0,It.w)(o=>{const i=o.tags,m=[];this.owner=o.owner;for(const u of Object.keys(this._appSettings.supportedFiles))for(const g of this._appSettings.supportedFiles[u])m.push(g);if(this.substoryContent.type=o.dataType?o.dataType:"",this.substoryContent.type){if(m.indexOf(this.substoryContent.type)>=0&&(this.substoryContent.type=this.substoryContent.type,this.substoryContent.type.indexOf("text")>=0)){const u=o.dataSize?+o.dataSize:0;if(u>this._appSettings.storyMaxSizeBytes)throw this.substoryContent.error=`Story is too big to be displayed. Size limit: ${this._appSettings.storyMaxSizeBytes}bytes. Story size: ${u} bytes.`,this.substoryContent.loading=!1,this.loadingSubstoryEvent.emit(!1),new Error(this.substoryContent.error);return this.loadContent(o.id)}}else for(const u of i)if("Content-Type"===u.name&&m.indexOf(u.value)>=0&&(this.substoryContent.type=u.value,u.value.indexOf("text")>=0)){const g=o.dataSize?+o.dataSize:0;if(g>this._appSettings.storyMaxSizeBytes)throw this.substoryContent.error=`Story is too big to be displayed. Size limit: ${this._appSettings.storyMaxSizeBytes}bytes. Story size: ${g} bytes.`,this.substoryContent.loading=!1,this.loadingSubstoryEvent.emit(!1),new Error(this.substoryContent.error);return this.loadContent(o.id)}throw new Error("Invalid substory type")})).subscribe({next:()=>{this.interceptClicks()},error:o=>{}})}loadContent(e){return this._arweave.getDataAsString(e).pipe((0,j.b)({next:o=>{this.substoryContent.raw=this._utils.sanitizeFull(`${o}`),this.substoryContent.raw.length<this.maxPreviewSize&&(this.realPreviewSize=this.substoryContent.raw.length),this.substoryContent.content=this.substr(this.substoryContent.raw,this.realPreviewSize),this.substoryContent.loading=!1,this.loadingSubstoryEvent.emit(!1)},error:o=>{this.substoryContent.error=o,this.substoryContent.loading=!1,this.loadingSubstoryEvent.emit(!1)}}))}loadMetadata(e){return this.substoryContent={type:"",loading:!0,content:"",error:"",raw:""},this._post.getPostById(e).pipe((0,j.b)({next:o=>{},error:o=>{this.substoryContent.error=o,this.substoryContent.loading=!1}}))}ngOnDestroy(){this.substoryContentSubscription.unsubscribe()}ngOnChanges(e){e&&e.substory&&!e.substory.firstChange&&("tx"===this.substory.type&&this.substory.id?this.loadTx(this.substory.id):"youtube"===this.substory.type&&this.substory.id&&this.loadYoutubeVideo(this.substory.id))}interceptClicks(){window.setTimeout(()=>{const e=this.contentContainer&&this.contentContainer.nativeElement?this.contentContainer.nativeElement.getElementsByTagName("a"):[];for(const o of e)o.addEventListener("click",i=>{i.stopPropagation(),i.preventDefault();const l=i.target;"_self"===l.getAttribute("target")?window.location.href=l.getAttribute("href"):this.confirmDialog(l.getAttribute("href"))})},400)}confirmDialog(e){const o=this._userSettings.getDefaultLang(),i=this._userSettings.getLangObject(o);this._dialog.open(k.z,{restoreFocus:!1,autoFocus:!1,disableClose:!1,data:{content:`Do you really want to visit this site? ${e}`,closeLabel:"No",confirmLabel:"Yes, open link in new tab"},direction:i&&"LTR"===i.writing_system?"ltr":"rtl"}).afterClosed().subscribe(u=>{u&&window.open(e,"_blank")})}openStory(e,o){e.stopPropagation(),this.confirmDialog(`${this._arweave.baseURL}${o}`)}openLink(e,o){e.stopPropagation(),this.confirmDialog(o)}showStoryMoreTextBtn(){return this.substoryContent.raw.length>this.maxPreviewSize&&this.realPreviewSize!==`${this.substoryContent.raw}`.length}substr(e,o){const i=o<=this.maxPreviewSize&&o<e.length?"...":"";return this._utils.sanitize(e.substr(0,o))+i}seeMore(e){e.stopPropagation(),this.realPreviewSize=`${this.substoryContent.raw}`.length,this.substoryContent.content=this.substr(this.substoryContent.raw,this.realPreviewSize),this.interceptClicks()}getYoutubeUrl(e){return this._utils.youtubeVideoURL(e)}loadYoutubeVideo(e){this.loadingSubstoryEvent.emit(!0),this.substoryContent.error="",this.substoryContent.type="youtube",this.substoryContent.loading=!1,this.substoryContent.content=this._utils.youtubeVideoURLSecure(e),this.loadingSubstoryEvent.emit(!1)}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(b.N),t.Y36(T.F),t.Y36(h.uw),t.Y36(J.s),t.Y36(P.X),t.Y36(F.L))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-story-player-substory"]],viewQuery:function(e,o){if(1&e&&t.Gf(Zt,5),2&e){let i;t.iGM(i=t.CRH())&&(o.contentContainer=i.first)}},inputs:{substory:"substory",fullMode:"fullMode"},outputs:{loadingSubstoryEvent:"loadingSubstoryEvent"},features:[t.TTD],decls:4,vars:3,consts:[[1,"content"],["class","substory-container",4,"ngIf"],["class","substory-container youtube-container",4,"ngIf"],[1,"substory-container"],["color","accent",3,"diameter",4,"ngIf"],["color","accent",3,"diameter"],["class","text-error fadeIn",4,"ngIf"],["class","content fadeIn",4,"ngIf"],[1,"text-error","fadeIn"],["mat-icon-button","","aria-label","Open in new window","matTooltip","Open in new window",1,"btn-open-anyway",3,"click"],[1,"material-icons-outlined"],[1,"content","fadeIn"],["contentContainer",""],[3,"innerHTML",4,"ngIf"],["class","text-right",4,"ngIf"],[3,"innerHTML"],[1,"text-right"],["mat-button","","color","accent","aria-label","See more","matTooltip","See more",1,"btn-see-more",3,"click"],["mat-button","","color","accent","aria-label","Open","matTooltip","Open",1,"btn-see-more",3,"routerLink"],[1,"substory-container","youtube-container"],["class","youtube-container fadeIn",4,"ngIf"],[1,"youtube-container","fadeIn"],["title","YouTube video player","frameborder","0","allow","accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture","allowfullscreen","",3,"src"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0),t.YNc(1,Lt,2,1,"div",1),t.YNc(2,Nt,3,2,"div",1),t.YNc(3,qt,4,3,"div",2),t.qZA()),2&e&&(t.xp6(1),t.Q6J("ngIf",o.substoryContent.loading),t.xp6(1),t.Q6J("ngIf","text/plain"===o.substoryContent.type&&!o.substoryContent.loading),t.xp6(1),t.Q6J("ngIf",o.substoryContent.type.indexOf("youtube")>=0&&!o.substoryContent.loading))},dependencies:[v.O5,_.Hw,f.lW,H.rH,$.gM,y.Ou],styles:[".content[_ngcontent-%COMP%]{float:left;width:calc(100% - 80px);height:100%;position:relative;text-align:center;overflow-y:auto}.substory-container[_ngcontent-%COMP%]{position:absolute;width:100%;min-height:100%;display:flex;justify-content:center;align-items:center}.substory-container.image[_ngcontent-%COMP%]{height:100%}.mat-spinner[_ngcontent-%COMP%]{margin:0 auto}.content[_ngcontent-%COMP%]   .image-container[_ngcontent-%COMP%]{width:100%;height:100%;background-size:contain;background-repeat:no-repeat;background-position:center center;cursor:pointer}.content[_ngcontent-%COMP%]   .text-container[_ngcontent-%COMP%]{width:100%;min-height:100%;display:flex;justify-content:center;align-items:center;padding:0 20px}.content[_ngcontent-%COMP%]   .text-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{padding:20px}.content[_ngcontent-%COMP%]   .text-error[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;justify-content:center;align-items:center;padding:0 20px;font-style:italic}.content[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;max-height:100%;object-fit:cover}.btn-see-more[_ngcontent-%COMP%]{text-decoration:underline}.content[_ngcontent-%COMP%]   .youtube-container[_ngcontent-%COMP%]{width:100%;height:100%;padding:0 20px}.content[_ngcontent-%COMP%]   .youtube-container[_ngcontent-%COMP%]   iframe[_ngcontent-%COMP%]{width:100%;height:100%}@media (min-width: 600px){.content[_ngcontent-%COMP%]{width:calc(100% - 120px)}}.content[_ngcontent-%COMP%]   .video-container[_ngcontent-%COMP%]{width:100%;height:100%;position:relative;display:flex;flex-direction:column;justify-content:center;align-items:center;cursor:pointer}.content[_ngcontent-%COMP%]   .video-container[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{max-width:80%;min-width:50%;text-align:center}.content[_ngcontent-%COMP%]   .audio-container[_ngcontent-%COMP%]{width:100%;height:100%;position:relative;display:flex;flex-direction:column;justify-content:center;align-items:center;cursor:pointer}.content[_ngcontent-%COMP%]   .audio-container[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{max-width:80%;min-width:50%;text-align:center}"]}),n})();const Ht=function(n){return{"background-color-theme":n}};function $t(n,s){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",9),t.NdJ("click",function(){const l=t.CHM(e).index,m=t.oxw();return t.KtG(m.playStoryByPosition(l))}),t.qZA(),t.BQk()}if(2&n){const e=s.$implicit,o=t.oxw();t.xp6(1),t.Q6J("ngClass",t.VKq(1,Ht,o.currentSubstory&&e.id===o.currentSubstory.id))}}let jt=(()=>{class n{constructor(e,o){this._userSettings=e,this._cd=o,this.isDarkTheme=!1,this.fullMode=!1,this.currentSubstory=null,this.currentSubstoryIdArrPos=0,this.infiniteScrollActive=!0,this.loadingSubstory=!1}fillSubstories(){this.currentSubstoryIdArrPos=0,this.currentSubstory=this.substories.length?this.substories[this.currentSubstoryIdArrPos]:null}ngOnInit(){this.fillSubstories(),this.isDarkTheme=this._userSettings.isDarkTheme(this._userSettings.getDefaultTheme()),this._userSettings.currentThemeStream.subscribe(e=>{this.isDarkTheme=this._userSettings.isDarkTheme(e)})}playNextStory(e){const o=this.substories.length;this.loadingSubstory||(this.infiniteScrollActive?"next"===e&&o>this.currentSubstoryIdArrPos+1?this.currentSubstoryIdArrPos+=1:"next"===e&&o<=this.currentSubstoryIdArrPos+1?this.currentSubstoryIdArrPos=0:"prev"===e&&this.currentSubstoryIdArrPos-1>=0?this.currentSubstoryIdArrPos-=1:"prev"===e&&this.currentSubstoryIdArrPos-1<0&&(this.currentSubstoryIdArrPos=o-1):"next"===e&&o>this.currentSubstoryIdArrPos+1?this.currentSubstoryIdArrPos+=1:"prev"===e&&this.currentSubstoryIdArrPos-1>=0&&(this.currentSubstoryIdArrPos-=1),this.currentSubstory=this.substories[this.currentSubstoryIdArrPos])}updateLoadingSubstory(e){this.loadingSubstory=e,this._cd.detectChanges()}playStoryByPosition(e){this.currentSubstoryIdArrPos=e,this.currentSubstory=this.substories[this.currentSubstoryIdArrPos]}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(J.s),t.Y36(t.sBO))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-post-player"]],inputs:{substories:"substories",fullMode:"fullMode"},decls:14,vars:7,consts:[[1,"player-container",3,"click"],[1,"arrow-small-container","vcenter"],[1,"arrow-small","border-color-theme"],["color","accent","mat-mini-fab","","aria-label","Previous",3,"disabled","click"],[1,"arrow-icon",3,"inline"],[3,"substory","fullMode","loadingSubstoryEvent"],["color","accent","mat-mini-fab","","aria-label","Next",3,"disabled","click"],[1,"player-circle-container","text-center","clear-both"],[4,"ngFor","ngForOf"],[1,"player-circle","border-color-theme",3,"ngClass","click"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0),t.NdJ("click",function(l){return l.stopPropagation()}),t.TgZ(1,"div",1)(2,"div",2)(3,"button",3),t.NdJ("click",function(){return o.playNextStory("prev")}),t.TgZ(4,"mat-icon",4),t._uU(5,"chevron_left"),t.qZA()()()(),t.TgZ(6,"app-story-player-substory",5),t.NdJ("loadingSubstoryEvent",function(l){return o.updateLoadingSubstory(l)}),t.qZA(),t.TgZ(7,"div",1)(8,"div",2)(9,"button",6),t.NdJ("click",function(){return o.playNextStory("next")}),t.TgZ(10,"mat-icon",4),t._uU(11,"chevron_right"),t.qZA()()()(),t.TgZ(12,"div",7),t.YNc(13,$t,2,3,"ng-container",8),t.qZA()()),2&e&&(t.xp6(3),t.Q6J("disabled",o.currentSubstoryIdArrPos-1<0&&!o.infiniteScrollActive||o.substories.length<=1||o.loadingSubstory),t.xp6(1),t.Q6J("inline",!0),t.xp6(2),t.Q6J("substory",o.currentSubstory)("fullMode",o.fullMode),t.xp6(3),t.Q6J("disabled",o.substories.length<=o.currentSubstoryIdArrPos+1&&!o.infiniteScrollActive||o.substories.length<=1||o.loadingSubstory),t.xp6(1),t.Q6J("inline",!0),t.xp6(3),t.Q6J("ngForOf",o.substories))},dependencies:[v.mk,v.sg,_.Hw,f.lW,Bt],styles:[".player-container[_ngcontent-%COMP%]{width:100%;margin:0 0 20px;height:320px;position:relative;cursor:default}.vcenter[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.player-container[_ngcontent-%COMP%]   .arrow-small-container[_ngcontent-%COMP%]{float:left;width:40px;height:100%;text-align:center;position:relative}.player-container[_ngcontent-%COMP%]   .arrow-small-container.arrow-dark[_ngcontent-%COMP%]{filter:invert(100%)}.arrow-small[_ngcontent-%COMP%]{width:100%;height:100%;position:relative;display:flex;flex-direction:column;justify-content:center;align-items:center}.arrow-icon[_ngcontent-%COMP%]{font-size:32px!important}.player-circle-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:center;padding:14px;flex-wrap:wrap}.player-circle[_ngcontent-%COMP%]{width:10px;height:10px;border-radius:10px;border:1px solid;margin-right:6px;margin-bottom:6px}.player-circle[_ngcontent-%COMP%]:hover{cursor:pointer}.player-circle.active[_ngcontent-%COMP%]{background-color:#000}.player-circle.active-dark[_ngcontent-%COMP%]{background-color:#fff}@media (min-width: 600px){.player-container[_ngcontent-%COMP%]   .arrow-small-container[_ngcontent-%COMP%]{width:60px}}"]}),n})();const Kt=["contentContainer"];function Wt(n,s){1&n&&(t.TgZ(0,"h4",2)(1,"mat-icon",3),t._uU(2,"repeat"),t.qZA(),t._uU(3," Reposted:\n"),t.qZA())}const K=function(){return{"height.px":62,"width.px":62,"marginTop.px":0}};function Gt(n,s){if(1&n&&t._UZ(0,"ngx-skeleton-loader",29),2&n){const e=t.oxw(3);t.Q6J("animation",e.isDarkTheme?"progress-dark":"progress")("theme",t.DdM(2,K))}}const R=function(n){return["/",n]};function Vt(n,s){if(1&n&&(t.TgZ(0,"img",30),t.NdJ("click",function(o){return o.stopPropagation()}),t.qZA()),2&n){const e=t.oxw(3);t.Q6J("routerLink",t.VKq(2,R,e.post.owner))("src",e.profileImage,t.LSH)}}function Xt(n,s){if(1&n&&(t.TgZ(0,"div",27),t.YNc(1,Gt,1,3,"ngx-skeleton-loader",10),t.YNc(2,Vt,1,4,"img",28),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",e.loadingProfile),t.xp6(1),t.Q6J("ngIf",!e.loadingProfile)}}function te(n,s){if(1&n&&t._UZ(0,"ngx-skeleton-loader",34),2&n){const e=t.oxw(3);t.Q6J("animation",e.isDarkTheme?"progress-dark":"progress")("theme",t.DdM(2,K))}}function ee(n,s){if(1&n&&(t.TgZ(0,"img",35),t.NdJ("click",function(o){return o.stopPropagation()}),t.qZA()),2&n){const e=t.oxw(3);t.Q6J("routerLink",t.VKq(2,R,e.post.owner))("src",e.profileImage,t.LSH)}}function ne(n,s){if(1&n&&(t.TgZ(0,"div",31),t.YNc(1,te,1,3,"ngx-skeleton-loader",32),t.YNc(2,ee,1,4,"img",33),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",e.loadingProfile),t.xp6(1),t.Q6J("ngIf",!e.loadingProfile)}}const oe=function(){return{"height.px":62,"width.px":62,"marginTop.px":0,"marginRight.px":12}};function ie(n,s){if(1&n&&t._UZ(0,"ngx-skeleton-loader",29),2&n){const e=t.oxw(2);t.Q6J("animation",e.isDarkTheme?"progress-dark":"progress")("theme",t.DdM(2,oe))}}function ae(n,s){if(1&n&&(t.TgZ(0,"img",36),t.NdJ("click",function(o){return o.stopPropagation()}),t.qZA()),2&n){const e=t.oxw(2);t.Q6J("routerLink",t.VKq(2,R,e.post.owner))("src",e.profileImage,t.LSH)}}const U=function(n){return{fullmode:n}};function se(n,s){if(1&n&&(t.TgZ(0,"span",42),t._uU(1),t.qZA()),2&n){const e=t.oxw(3);t.Q6J("ngClass",t.VKq(2,U,e.fullMode)),t.xp6(1),t.Oqu(e.profile.name)}}function re(n,s){if(1&n&&(t.TgZ(0,"small",43),t._uU(1),t.qZA()),2&n){const e=t.oxw(3);t.Q6J("ngClass",t.VKq(2,U,e.fullMode)),t.xp6(1),t.hij(" ",e.profile.username," ")}}function ce(n,s){if(1&n&&(t.TgZ(0,"small",44),t._UZ(1,"app-arweave-address",45),t.qZA()),2&n){const e=t.oxw(3);t.Q6J("ngClass",t.VKq(5,U,e.fullMode)),t.xp6(1),t.Q6J("address",e.post.owner)("showCopyBtn",!1)("showOpenVieblockBtn",!1)("showVerifiedBtn",!0)}}function le(n,s){if(1&n&&(t.TgZ(0,"small",46),t._uU(1),t.qZA()),2&n){const e=t.oxw(3);t.Q6J("ngClass",t.VKq(2,U,e.fullMode)),t.xp6(1),t.hij(" \xb7 ",e.post.blockTimestamp," ")}}function pe(n,s){if(1&n&&(t.TgZ(0,"h2",37),t.NdJ("click",function(o){return o.stopPropagation()}),t.YNc(1,se,2,4,"span",38),t.YNc(2,re,2,4,"small",39),t.YNc(3,ce,2,7,"small",40),t.YNc(4,le,2,4,"small",41),t.qZA()),2&n){const e=t.oxw(2);t.Q6J("routerLink",t.VKq(5,R,e.post.owner)),t.xp6(1),t.Q6J("ngIf",e.profile&&e.profile.name),t.xp6(1),t.Q6J("ngIf",e.profile&&e.profile.username),t.xp6(1),t.Q6J("ngIf",e.post),t.xp6(1),t.Q6J("ngIf",e.post&&e.post.blockTimestamp)}}function de(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"button",47),t.NdJ("click",function(i){t.CHM(e);const l=t.oxw(2);return i.stopPropagation(),t.KtG(l.goBack())}),t.TgZ(1,"mat-icon"),t._uU(2,"arrow_back"),t.qZA()()}}function ge(n,s){if(1&n&&(t.TgZ(0,"span",18),t._uU(1),t.qZA()),2&n){const e=t.oxw(3);t.xp6(1),t.hij("Application: ",e.application," ")}}function _e(n,s){if(1&n&&(t.TgZ(0,"span",18),t._uU(1),t.qZA()),2&n){const e=t.oxw(3);t.xp6(1),t.hij("App-Name: ",e.appName,"")}}function ue(n,s){if(1&n&&(t.TgZ(0,"span",18),t._uU(1),t.qZA()),2&n){const e=t.oxw(3);t.xp6(1),t.hij("Service: ",e.service," ")}}function me(n,s){if(1&n&&(t.TgZ(0,"span",18),t._uU(1),t.qZA()),2&n){const e=t.oxw(3);t.xp6(1),t.hij("Post type: ",e.postType,"")}}function he(n,s){if(1&n&&(t.TgZ(0,"span",18),t._uU(1),t.qZA()),2&n){const e=t.oxw(3);t.xp6(1),t.hij("Content type: ",e.postContentType,"")}}function fe(n,s){if(1&n&&(t.TgZ(0,"span",18),t._uU(1),t.qZA()),2&n){const e=t.oxw(3);t.xp6(1),t.hij("Owner: ",e.owner,"")}}function be(n,s){if(1&n&&(t.TgZ(0,"span",18),t._uU(1),t.qZA()),2&n){const e=t.oxw(3);t.xp6(1),t.hij("Version: ",e.postVersion,"")}}function ye(n,s){if(1&n&&(t.TgZ(0,"mat-list-item",48)(1,"h4",49),t._uU(2,"Tx metadata:"),t.qZA(),t.YNc(3,ge,2,1,"span",50),t.YNc(4,_e,2,1,"span",50),t.YNc(5,ue,2,1,"span",50),t.YNc(6,me,2,1,"span",50),t.YNc(7,he,2,1,"span",50),t.YNc(8,fe,2,1,"span",50),t.YNc(9,be,2,1,"span",50),t.qZA()),2&n){const e=t.oxw(2);t.xp6(3),t.Q6J("ngIf",e.application),t.xp6(1),t.Q6J("ngIf",e.appName),t.xp6(1),t.Q6J("ngIf",e.service),t.xp6(1),t.Q6J("ngIf",e.postType),t.xp6(1),t.Q6J("ngIf",e.postContentType),t.xp6(1),t.Q6J("ngIf",e.owner),t.xp6(1),t.Q6J("ngIf",e.postVersion)}}const Ce=function(){return{"height.px":22,width:"60%","marginBottom.px":12,"marginTop.px":0}};function xe(n,s){if(1&n&&t._UZ(0,"ngx-skeleton-loader",51),2&n){const e=t.oxw(2);t.Q6J("animation",e.isDarkTheme?"progress-dark":"progress")("theme",t.DdM(2,Ce))}}const W=function(){return{"height.px":18,"marginBottom.px":8,"marginTop.px":0,width:"100%"}};function ve(n,s){if(1&n&&t._UZ(0,"ngx-skeleton-loader",51),2&n){const e=t.oxw(2);t.Q6J("animation",e.isDarkTheme?"progress-dark":"progress")("theme",t.DdM(2,W))}}function Te(n,s){if(1&n&&t._UZ(0,"ngx-skeleton-loader",51),2&n){const e=t.oxw(2);t.Q6J("animation",e.isDarkTheme?"progress-dark":"progress")("theme",t.DdM(2,W))}}const Pe=function(){return{"height.px":18,"marginBottom.px":20,"marginTop.px":0,width:"90%"}};function we(n,s){if(1&n&&t._UZ(0,"ngx-skeleton-loader",51),2&n){const e=t.oxw(2);t.Q6J("animation",e.isDarkTheme?"progress-dark":"progress")("theme",t.DdM(2,Pe))}}function ke(n,s){if(1&n&&t._UZ(0,"p",56),2&n){const e=t.oxw(3);t.Q6J("innerHTML",e.content,t.oJD)}}function Oe(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"div",57)(1,"button",58),t.NdJ("click",function(i){t.CHM(e);const l=t.oxw(3);return t.KtG(l.readMore(i))}),t._uU(2," See more "),t.qZA()()}}function Me(n,s){if(1&n&&(t.ynx(0),t.TgZ(1,"div",52,53),t.YNc(3,ke,1,1,"p",54),t.YNc(4,Oe,3,0,"div",55),t.qZA(),t.BQk()),2&n){const e=t.oxw(2);t.xp6(3),t.Q6J("ngIf",!e.loadingContent&&e.content),t.xp6(1),t.Q6J("ngIf",!e.loadingContent&&e.originalRawContent&&e.showStoryMoreTextBtn())}}function Se(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"div",59)(1,"span"),t._uU(2),t.qZA(),t.TgZ(3,"button",60),t.NdJ("click",function(i){t.CHM(e);const l=t.oxw(2);return t.KtG(l.openStory(i,l.post.id))}),t.TgZ(4,"mat-icon",61),t._uU(5,"open_in_new"),t.qZA()()()}if(2&n){const e=t.oxw(2);t.xp6(2),t.hij(" ",e.contentError," ")}}function Ie(n,s){if(1&n&&(t.TgZ(0,"div",62),t._UZ(1,"app-post-player",63),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("substories",e.substories)("fullMode",e.fullMode)}}function Ze(n,s){1&n&&(t.TgZ(0,"div",64)(1,"span"),t._uU(2,"Pending TX"),t.qZA(),t._UZ(3,"mat-spinner",65),t.qZA())}function Ae(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"div",66)(1,"div",67)(2,"button",68),t.NdJ("click",function(i){t.CHM(e);const l=t.oxw(2);return t.KtG(l.reply(i))}),t.TgZ(3,"mat-icon",61),t._uU(4,"reply"),t.qZA(),t.TgZ(5,"div"),t._uU(6),t.ALo(7,"translate"),t.qZA()()(),t.TgZ(8,"div",67)(9,"button",69),t.NdJ("click",function(i){t.CHM(e);const l=t.oxw(2);return t.KtG(l.repost(i))}),t.TgZ(10,"mat-icon",61),t._uU(11,"repeat"),t.qZA(),t.TgZ(12,"div"),t._uU(13),t.ALo(14,"translate"),t.qZA()()(),t.TgZ(15,"div",67)(16,"button",70),t.NdJ("click",function(i){t.CHM(e);const l=t.oxw(2);return t.KtG(l.like(i))}),t.TgZ(17,"mat-icon",61),t._uU(18,"favorite"),t.qZA(),t.TgZ(19,"div"),t._uU(20),t.ALo(21,"translate"),t.qZA()()(),t.TgZ(22,"div",67)(23,"button",71),t.NdJ("click",function(i){t.CHM(e);const l=t.oxw(2);return t.KtG(l.share(i))}),t.TgZ(24,"mat-icon",61),t._uU(25,"share"),t.qZA(),t.TgZ(26,"div"),t._uU(27),t.ALo(28,"translate"),t.qZA()()()()}2&n&&(t.xp6(6),t.Oqu(t.lcZ(7,4,"GENERAL.STORY.REPLY")),t.xp6(7),t.Oqu(t.lcZ(14,6,"GENERAL.STORY.REPOST")),t.xp6(7),t.Oqu(t.lcZ(21,8,"GENERAL.STORY.LIKE")),t.xp6(7),t.Oqu(t.lcZ(28,10,"GENERAL.STORY.SHARE")))}const Le=function(n,s){return["/",n,s]},Re=function(n){return{"card-content":n}};function Ue(n,s){if(1&n&&(t.TgZ(0,"mat-card",4)(1,"mat-card-content")(2,"div",5),t.YNc(3,Xt,3,2,"div",6),t.YNc(4,ne,3,2,"div",7),t.TgZ(5,"div",8)(6,"div",9),t.YNc(7,ie,1,3,"ngx-skeleton-loader",10),t.YNc(8,ae,1,4,"img",11),t.YNc(9,pe,5,7,"h2",12),t.TgZ(10,"div",13),t.YNc(11,de,3,0,"button",14),t.TgZ(12,"button",15),t.NdJ("click",function(o){return o.stopPropagation()}),t.TgZ(13,"mat-icon"),t._uU(14,"more_horiz"),t.qZA()(),t.TgZ(15,"mat-menu",null,16)(17,"mat-list",17)(18,"mat-list-item")(19,"h3",18),t._uU(20," TX Info "),t.qZA(),t.TgZ(21,"div",18)(22,"app-arweave-address",19),t._uU(23,"Id: "),t.qZA()()(),t.YNc(24,ye,10,7,"mat-list-item",20),t.qZA()()(),t.YNc(25,xe,1,3,"ngx-skeleton-loader",21),t.qZA(),t.YNc(26,ve,1,3,"ngx-skeleton-loader",21),t.YNc(27,Te,1,3,"ngx-skeleton-loader",21),t.YNc(28,we,1,3,"ngx-skeleton-loader",21),t.YNc(29,Me,5,2,"ng-container",22),t.YNc(30,Se,6,1,"div",23),t.YNc(31,Ie,2,2,"div",24),t.YNc(32,Ze,4,0,"div",25),t.qZA()()(),t.TgZ(33,"mat-card-actions"),t.YNc(34,Ae,29,12,"div",26),t.qZA()()),2&n){const e=t.MAs(16),o=t.oxw();t.Q6J("routerLink",t.WLB(21,Le,o.post.owner,o.post.id)),t.xp6(2),t.Q6J("ngClass",t.VKq(24,Re,!o.fullMode)),t.xp6(1),t.Q6J("ngIf",!o.fullMode),t.xp6(1),t.Q6J("ngIf",o.fullMode),t.xp6(3),t.Q6J("ngIf",o.loadingProfile&&o.fullMode),t.xp6(1),t.Q6J("ngIf",!o.loadingProfile&&o.fullMode),t.xp6(1),t.Q6J("ngIf",!o.loadingProfile),t.xp6(2),t.Q6J("ngIf",o.fullMode),t.xp6(1),t.Q6J("matMenuTriggerFor",e),t.xp6(10),t.Q6J("address",o.post.id)("isAddress",!1),t.xp6(2),t.Q6J("ngIf",!(o.loadingContent||o.post&&(!o.post.blockId||0==o.post.blockHeight))),t.xp6(1),t.Q6J("ngIf",o.loadingProfile),t.xp6(1),t.Q6J("ngIf",o.loadingContent),t.xp6(1),t.Q6J("ngIf",o.loadingContent),t.xp6(1),t.Q6J("ngIf",o.loadingContent),t.xp6(1),t.Q6J("ngIf",o.validateContentType(o.postContentType,"text")),t.xp6(1),t.Q6J("ngIf",!o.loadingContent&&o.contentError),t.xp6(1),t.Q6J("ngIf",o.substories.length),t.xp6(1),t.Q6J("ngIf",o.post&&(!o.post.blockId||0==o.post.blockHeight)),t.xp6(2),t.Q6J("ngIf",!o.loadingContent&&!(o.post&&(!o.post.blockId||0==o.post.blockHeight))&&o.showActions)}}let De=(()=>{class n{constructor(e,o,i,l,m,u,g,Z,Y,O){this._profile=e,this._auth=o,this._arweave=i,this._userSettings=l,this._utils=m,this._bottomSheetShare=u,this._dialog=g,this._location=Z,this._post=Y,this._appSettings=O,this.fullMode=!1,this.txId="",this.showActions=!0,this.loadingContent=!1,this.loadingProfile=!1,this.profileImage="assets/images/blank-profile.png",this.profileSubscription=x.w0.EMPTY,this.contentSubscription=x.w0.EMPTY,this.profile=null,this.content="",this.originalRawContent="",this.isDarkTheme=!1,this.themeSubscription=x.w0.EMPTY,this.substories=[],this.service="",this.application="",this.appName="",this.owner="",this.postType="",this.postContentType="",this.contentError="",this.postVersion="",this.maxPreviewSize=250,this.realPreviewSize=this.maxPreviewSize,this.loadingPostMetadata=!1,this._postMetadataSubscription=x.w0.EMPTY,this.repostId="",this.isReposted=!1}ngOnInit(){this.txId?this.loadPostAndThenData(this.txId):this.post&&this.loadData()}loadPostAndThenData(e,o=0){this.loadingPostMetadata=!0,this._postMetadataSubscription=this._post.getPostById(e).subscribe({next:i=>{this.post=i,this.loadData(o)},error:i=>{this.loadingPostMetadata=!1,this._utils.message(i,"error")}})}loadData(e=0){this.loadProfile(),this.loadContent(e),this.post.blockTimestamp&&(this.post.blockTimestamp=this._utils.dateFormat(this.post.blockTimestamp)),this.isDarkTheme=this._userSettings.isDarkTheme(this._userSettings.getDefaultTheme()),this.themeSubscription=this._userSettings.currentThemeStream.subscribe(o=>{this.isDarkTheme=this._userSettings.isDarkTheme(o)})}extractTagsFromPost(e){const o=e.tags;if(o)for(const i of o)"App-Name"===i.name?this.appName=i.value:"Application"===i.name||"Service"===i.name?this.application=i.value:"Type"===i.name?this.postType=i.value:"Content-Type"===i.name?this.postContentType=i.value:"Version"===i.name?this.postVersion=i.value:"Post-Id"===i.name&&(this._arweave.validateAddress(i.value)?this.repostId=i.value:console.error("Invalid Repost Story Id",i));else console.error("Tags not found",e)}loadProfile(){const e=this.post.owner;this.loadingProfile=!0,this.profile=null,this.profileSubscription=this._profile.getProfileByAddress(e).subscribe({next:o=>{this.profileImage="assets/images/blank-profile.jpg",o&&(o.avatarURL&&(this.profileImage=o.avatarURL),this.profile=o),this.loadingProfile=!1},error:o=>{this.loadingProfile=!1,this._utils.message(o,"error")}})}ngOnDestroy(){this.contentSubscription.unsubscribe(),this.profileSubscription.unsubscribe(),this.themeSubscription.unsubscribe()}ellipsis(e){return this._utils.ellipsis(e)}reply(e){e.stopPropagation();const o=this._userSettings.getDefaultLang(),i=this._userSettings.getLangObject(o);let l=i&&"LTR"===i.writing_system?"ltr":"rtl";const m=this._auth.getMainAddressSnapshot();this._dialog.open(ot,{restoreFocus:!1,autoFocus:!1,disableClose:!0,data:{myAddress:m,txId:this.post.id,postOwner:this.post.owner,postOwnerUsername:this.profile&&this.profile.username?this.profile.username:"",postOwnerImage:this.profileImage,postContent:this.originalRawContent,contentType:this.postContentType},direction:l}).afterClosed().subscribe(g=>{})}repost(e){e.stopPropagation();const o=this._userSettings.getDefaultLang(),i=this._userSettings.getLangObject(o);let l=i&&"LTR"===i.writing_system?"ltr":"rtl";const m=this._auth.getMainAddressSnapshot();this._dialog.open(Tt,{restoreFocus:!1,autoFocus:!1,disableClose:!1,data:{myAddress:m,txId:this.post.id,postOwner:this.post.owner,postOwnerUsername:this.profile&&this.profile.username?this.profile.username:"",postOwnerImage:this.profileImage,postContent:this.originalRawContent,contentType:this.postContentType},direction:l}).afterClosed().subscribe(g=>{})}like(e){e.stopPropagation();const o=this._userSettings.getDefaultLang(),i=this._userSettings.getLangObject(o);let l=i&&"LTR"===i.writing_system?"ltr":"rtl";const m=this._auth.getMainAddressSnapshot();this._dialog.open(_t,{restoreFocus:!1,autoFocus:!1,disableClose:!0,data:{myAddress:m,txId:this.post.id,postOwner:this.post.owner,postOwnerUsername:this.profile&&this.profile.username?this.profile.username:"",postOwnerImage:this.profileImage,postContent:this.originalRawContent,contentType:this.postContentType},direction:l}).afterClosed().subscribe(g=>{})}openStory(e,o){e.stopPropagation(),this.confirmDialog(`${this._arweave.baseURL}${o}`)}share(e){e.stopPropagation(),this._userSettings.getDefaultLang();const m=this._utils.sanitizeFull(this.originalRawContent),g=this.post.owner;this._bottomSheetShare.open(c.n,{data:{title:"Post from Public Square!",content:this._utils.sanitizeFull(`${m} ...`.substr(0,200)),img:"",fullURL:`${this._utils.getBaseURL()}#/${g}/${this.post.id}`},direction:"ltr",ariaLabel:"Share on social media"})}readMore(e){e.stopPropagation(),this.realPreviewSize=this.originalRawContent.length,this.content=this.substr(this.originalRawContent,this.realPreviewSize),this.interceptClicks()}detectYouTubeLinks(e){const o=[];return e.filter(m=>{const u=new URL(m),g=u.hostname,Z=u.search,Y=u.pathname;if(/youtube.com/.test(g)){let A=new URLSearchParams(Z).get("v");return A&&(A=A.substr(0,15),o.indexOf(A)<0&&o.push(A)),!0}if(/youtu.be/.test(g)){let O=this._utils.removeInitialSymbol(Y,"/");return O&&(O=O.substr(0,15),o.indexOf(O)<0&&o.push(O)),!0}return!1}),o}_loadContentHelperLoadContent(e){this.loadingContent=!0,this.contentSubscription=this._arweave.getDataAsString(e).subscribe({next:o=>{this.originalRawContent=this._utils.sanitizeFull(`${o}`);const l=this._utils.getLinks(`${this.originalRawContent}`).map(u=>u.href),m=this.detectYouTubeLinks(l);for(const u of m)this.substories.push({id:u,type:"youtube"});this.content=this.substr(this.originalRawContent,this.maxPreviewSize),this.loadingContent=!1,this.interceptClicks()},error:o=>{this.loadingContent=!1,console.error("_loadContentHelperLoadContent error",o)}})}showStoryMoreTextBtn(){return this.originalRawContent.length>this.maxPreviewSize&&this.realPreviewSize!==`${this.originalRawContent}`.length}substr(e,o){const i=o<=this.maxPreviewSize&&o<e.length?"...":"";return this._utils.sanitize(e.substr(0,o))+i}loadContent(e=0){const o=this.post.dataSize?+this.post.dataSize:0;this.owner=this.post.owner,this.postContentType=this.post.dataType?this.post.dataType:"",this.extractTagsFromPost(this.post),"post"===this.postType||"reply"===this.postType?o<=this._appSettings.storyMaxSizeBytes&&this.validateContentType(this.postContentType,"text")?this._loadContentHelperLoadContent(this.post.id):this.contentError=this.post&&void 0!==this.post.dataSize?`Story is too big to be displayed.\n          Size limit for text: ${this._appSettings.storyMaxSizeBytes}bytes.\n          Story size: ${this.post.dataSize} bytes.`:"Transaction is pending ...":"repost"!==this.postType||""===this.repostId||e?"repost"!==this.postType&&""!==this.postType&&(this.contentError=`Unknown story type \u{1f47d} ${this.post.id} - ${this.postType}`):(this.isReposted=!0,this.loadPostAndThenData(this.repostId,e+1))}interceptClicks(){window.setTimeout(()=>{const e=this.contentContainer&&this.contentContainer.nativeElement?this.contentContainer.nativeElement.getElementsByTagName("a"):[];for(const o of e)o.addEventListener("click",i=>{i.stopPropagation(),i.preventDefault();const l=i.target;"_self"===l.getAttribute("target")?window.location.href=l.getAttribute("href"):this.confirmDialog(l.getAttribute("href"))})},400)}confirmDialog(e){const o=this._userSettings.getDefaultLang(),i=this._userSettings.getLangObject(o);this._dialog.open(k.z,{restoreFocus:!1,autoFocus:!1,disableClose:!0,data:{content:`Do you really want to visit this site? ${e}`,closeLabel:"No",confirmLabel:"Yes, open link in new tab"},direction:i&&"LTR"===i.writing_system?"ltr":"rtl"}).afterClosed().subscribe(u=>{u&&window.open(e,"_blank")})}validateContentType(e,o){return!!Object.prototype.hasOwnProperty.call(this._appSettings.supportedFiles,o)&&this._appSettings.supportedFiles[o].indexOf(e)>=0}getFullImgUrlFromTx(e){return`${this._arweave.baseURL}${e}`}goBack(){this._location.back()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(Pt.H),t.Y36(z.H),t.Y36(b.N),t.Y36(J.s),t.Y36(T.F),t.Y36(wt.ch),t.Y36(h.uw),t.Y36(v.Ye),t.Y36(F.L),t.Y36(P.X))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-post-card"]],viewQuery:function(e,o){if(1&e&&t.Gf(Kt,5),2&e){let i;t.iGM(i=t.CRH())&&(o.contentContainer=i.first)}},inputs:{post:"post",fullMode:"fullMode",txId:"txId",showActions:"showActions"},decls:3,vars:2,consts:[["class","label-reposted",4,"ngIf"],["class","post-card fadeIn mat-elevation-z0",3,"routerLink",4,"ngIf"],[1,"label-reposted"],["aria-label","Reposted","color","accent"],[1,"post-card","fadeIn","mat-elevation-z0",3,"routerLink"],[3,"ngClass"],["class","avatar-container",4,"ngIf"],["class","text-center",4,"ngIf"],[1,"story-container"],[1,"story-title"],["appearance","circle",3,"animation","theme",4,"ngIf"],["class","avatar-fullmode","mat-card-avatar","",3,"routerLink","src","click",4,"ngIf"],["class","profile-name-container",3,"routerLink","click",4,"ngIf"],[1,"profile-secondary-actions","text-right"],["mat-icon-button","","color","accent","aria-label","Go back",3,"click",4,"ngIf"],["mat-icon-button","","color","accent","aria-label","More options",3,"matMenuTriggerFor","click"],["moreOptionsMenu","matMenu"],[1,"tx-info-container"],["matLine",""],[1,"small-username-2",3,"address","isAddress"],["class","tx-metadata-chips",4,"ngIf"],["appearance","line",3,"animation","theme",4,"ngIf"],[4,"ngIf"],["class","content-error fadeIn",4,"ngIfClear-both","ngIf"],["class","clear-both",4,"ngIf"],["class","fadeIn pending",4,"ngIf"],["class","fadeIn story-actions",4,"ngIf"],[1,"avatar-container"],["class","avatar","mat-card-avatar","",3,"routerLink","src","click",4,"ngIf"],["appearance","circle",3,"animation","theme"],["mat-card-avatar","",1,"avatar",3,"routerLink","src","click"],[1,"text-center"],["class","avatar-fullmode-main","appearance","circle",3,"animation","theme",4,"ngIf"],["class","avatar-fullmode-main","mat-card-avatar","",3,"routerLink","src","click",4,"ngIf"],["appearance","circle",1,"avatar-fullmode-main",3,"animation","theme"],["mat-card-avatar","",1,"avatar-fullmode-main",3,"routerLink","src","click"],["mat-card-avatar","",1,"avatar-fullmode",3,"routerLink","src","click"],[1,"profile-name-container",3,"routerLink","click"],["class","ellipsis profile-name word-break",3,"ngClass",4,"ngIf"],["class","profile-username",3,"ngClass",4,"ngIf"],["class","profile-address",3,"ngClass",4,"ngIf"],["class","profile-story-date",3,"ngClass",4,"ngIf"],[1,"ellipsis","profile-name","word-break",3,"ngClass"],[1,"profile-username",3,"ngClass"],[1,"profile-address",3,"ngClass"],[1,"address",3,"address","showCopyBtn","showOpenVieblockBtn","showVerifiedBtn"],[1,"profile-story-date",3,"ngClass"],["mat-icon-button","","color","accent","aria-label","Go back",3,"click"],[1,"tx-metadata-chips"],["matLine","",1,"meta"],["matLine","",4,"ngIf"],["appearance","line",3,"animation","theme"],[1,"content","fadeIn"],["contentContainer",""],[3,"innerHTML",4,"ngIf"],["class","text-right",4,"ngIf"],[3,"innerHTML"],[1,"text-right"],["mat-button","","color","accent","aria-label","See more","matTooltip","See more",1,"btn-see-more",3,"click"],[1,"content-error","fadeIn"],["mat-icon-button","","aria-label","Open in new window","matTooltip","Open in new window",1,"btn-open-anyway",3,"click"],[1,"material-icons-outlined"],[1,"clear-both"],[3,"substories","fullMode"],[1,"fadeIn","pending"],["color","accent","diameter","26",1,""],[1,"fadeIn","story-actions"],[1,"action-btn-wrapper"],["mat-button","","aria-label","Reply",1,"blue-hover",3,"click"],["mat-button","","aria-label","Repost",1,"green-hover",3,"click"],["mat-button","","aria-label","Like",1,"pink-hover",3,"click"],["mat-button","","aria-label","Share Story",1,"orange-hover",3,"click"]],template:function(e,o){1&e&&(t.YNc(0,Wt,4,0,"h4",0),t.YNc(1,Ue,35,26,"mat-card",1),t._UZ(2,"mat-divider")),2&e&&(t.Q6J("ngIf",o.isReposted),t.xp6(1),t.Q6J("ngIf",o.post))},dependencies:[v.mk,v.O5,q.i$,q.Tg,kt.X2,Ot.d,_.Hw,a.a8,a.dn,a.hq,a.kc,f.lW,Mt.xr,B.VK,B.p6,H.rH,$.gM,y.Ou,St.N,jt,r.X$],styles:[".post-card[_ngcontent-%COMP%]{width:100%;margin:0 auto;padding:12px 12px 10px;border-radius:0}.post-card[_ngcontent-%COMP%]:hover{cursor:pointer;box-shadow:0 3px 3px -2px #0003,0 3px 4px #00000024,0 1px 8px #0000001f}mat-card-header[_ngcontent-%COMP%]{width:100%;margin-bottom:20px}.card-content[_ngcontent-%COMP%]{min-height:100px;position:relative;clear:both;display:inline-grid;margin-bottom:12px;width:100%}.loading-avatar[_ngcontent-%COMP%]{float:left}.avatar-container[_ngcontent-%COMP%]{min-height:100%;text-align:center}.avatar[_ngcontent-%COMP%]{width:62px;height:62px;cursor:pointer}.avatar-fullmode[_ngcontent-%COMP%]{width:62px;height:62px;cursor:pointer;margin-right:16px;display:none}.avatar-fullmode-main[_ngcontent-%COMP%]{width:62px;height:62px;cursor:pointer}.story-title[_ngcontent-%COMP%]{display:flex;margin-bottom:12px}.story-container[_ngcontent-%COMP%]{width:100%;min-height:100%;word-break:normal;overflow-wrap:anywhere}.story-container[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{min-height:30px;clear:both;margin-bottom:20px}.story-container[_ngcontent-%COMP%]   .content-error[_ngcontent-%COMP%]{min-height:40px;clear:both;margin-bottom:6px;font-style:italic}.story-container[_ngcontent-%COMP%]   .content-error[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:6px}.story-container[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{word-break:break-all;text-overflow:ellipsis}.mat-card-actions[_ngcontent-%COMP%]{margin-top:22px}@media (min-width: 800px){.post-card[_ngcontent-%COMP%]{padding:52px 80px 20px}.profile-username[_ngcontent-%COMP%]{margin-right:12px;margin-left:6px}.profile-name.fullmode[_ngcontent-%COMP%], .profile-username.fullmode[_ngcontent-%COMP%], .profile-story-date.fullmode[_ngcontent-%COMP%]{line-height:62px!important}.profile-address.fullmode[_ngcontent-%COMP%]{line-height:50px!important}.profile-address[_ngcontent-%COMP%]{margin-top:0}.profile-name-container[_ngcontent-%COMP%]{flex-direction:row!important}.profile-secondary-actions[_ngcontent-%COMP%]{margin-top:-12px}.card-content[_ngcontent-%COMP%]{display:flex}.avatar-container[_ngcontent-%COMP%]{width:82px;text-align:left;margin-right:12px}.avatar-fullmode[_ngcontent-%COMP%]{display:block}.avatar-fullmode-main[_ngcontent-%COMP%]{display:none}}h2[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-right:0}h2[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{font-size:12px;font-weight:400;font-style:italic}.profile-name-container[_ngcontent-%COMP%]{cursor:pointer;flex-grow:1;display:flex;flex-direction:column}.profile-secondary-actions[_ngcontent-%COMP%]{float:left}.profile-name[_ngcontent-%COMP%]:hover{text-decoration:underline}.profile-address[_ngcontent-%COMP%], .profile-name[_ngcontent-%COMP%], .profile-username[_ngcontent-%COMP%]{display:block}.profile-username[_ngcontent-%COMP%]{opacity:.8}.profile-address[_ngcontent-%COMP%]{margin-top:6px;opacity:.8}.profile-name[_ngcontent-%COMP%], .profile-username[_ngcontent-%COMP%], .profile-story-date[_ngcontent-%COMP%]{line-height:26px}.profile-address[_ngcontent-%COMP%]{line-height:12px}.tx[_ngcontent-%COMP%]{font-size:12px}.story-actions[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.story-actions[_ngcontent-%COMP%]   .mat-button[_ngcontent-%COMP%]{width:100%;transition:color .5s ease-out}.story-actions[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{font-size:22px}.story-actions[_ngcontent-%COMP%]   .action-btn-wrapper[_ngcontent-%COMP%]{flex-grow:1;flex-wrap:wrap;text-align:center}.story-actions[_ngcontent-%COMP%]   .action-btn-wrapper[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-size:10px;margin-bottom:10px;font-weight:400;text-align:center;line-height:10px}.pending[_ngcontent-%COMP%]{padding:10px;font-size:12px;text-align:right;display:flex;justify-content:flex-end}.pending[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{line-height:32px}.pending[_ngcontent-%COMP%]   .mat-spinner[_ngcontent-%COMP%]{margin-left:20px}.tx-info-container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:4px;font-size:12px;font-weight:700}.btn-open-anyway[_ngcontent-%COMP%]{margin-left:10px;font-size:12px!important}.btn-see-more[_ngcontent-%COMP%]{text-decoration:underline}.tx-metadata-chips[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:10px!important;background-color:#000;color:#fff;padding:4px;margin-left:4px;display:block;margin-bottom:4px}.story-image-container[_ngcontent-%COMP%]{text-align:center;padding:20px}.story-image-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%}.meta[_ngcontent-%COMP%]{margin-bottom:12px!important}.story-video-container[_ngcontent-%COMP%]{text-align:center;padding:20px}.story-video-container[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{max-width:80%}.story-audio-container[_ngcontent-%COMP%]{text-align:center;padding:20px}.story-audio-container[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{max-width:80%}.label-reposted[_ngcontent-%COMP%]{padding-left:20px;margin:20px 0 0}"]}),n})()}}]);